<!DOCTYPE html>
<html lang="ru">
<head>
        <meta charset="windows-1251">
        <title>
                Блог компании Яндекс.
        </title>
</head>
<body>
<main>
        <header>
                <h1>Блог компании <span style="color: red;">Я</span>ндекс.</h1>
        </header>
        <article>
                <h2>ЯНДЕКС.ПОЧТА: КАК МЫ ИЗМЕРЯЕМ СКОРОСТЬ ЗАГРУЗКИ И УЛУЧШАЕМ ЕЁ</h2>
                <p>Если ваш сайт медленно грузится, вы рискуете тем, что люди не оценят ни то,<br>
                   какой он красивый, ни то, какой он удобный. Никому не понравится, когда все<br>
                   тормозит. Мы регулярно добавляем в Яндекс.Почту новую функциональность,<br>
                   иногда — исправляем ошибки, а это значит, у нас постоянно появляются новый код<br>
                   и новая логика. Всё это напрямую влияет на скорость работы интерфейса.<br>
                </p>
                <section>
                        <header>
                                <h3>Что мы измеряем</h3>
                        </header>
                        <p>Этапы первой загрузки:
                                <ul style="list-style-type: '* '">
                                        <li>подготовка;</li>
                                        <li>загрузка статики (HTTP-запрос и парсинг);</li>
                                        <li>исполнение модулей;</li>
                                        <li>инициализация базовых объектов;</li>
                                        <li>отрисовка.</li>
                                </ul>
                        </p>
                        <p>Этапы отрисовки любой страницы:
                                <ul style="list-style-type: '* '">
                                        <li>подготовка к запросу на сервер;</li>
                                        <li>запрос данных с сервера;</li>
                                        <li>шаблонизация;</li>
                                        <li>обновление DOM.</li>
                                </ul>
                        </p>
                        <p>

                                — <q>Ок, теперь у нас есть метрики, мы можем отправить их на сервер</q> - говорим мы <br>
                                — <q>Что же дальше?</q>  - вопрошаете вы <br>
                                — <q>А давай построим график!</q>  - отвечаем мы <br>
                                — <q>А что будем считать?</q>  - уточняете вы <br>

                        </p>
                        <p>
                                Как вы знаете, медиана – это <em>серединное</em>, а не среднее значение в выборке.<br>
                                Если у нас имеются числа 1, 2, 2, 3, 8, 10, 20, то медиана – 3, а среднее – 6,5.<br>
                                В общем случае медиана отлично показывает, сколько грузится средний пользователь.<br>
                        </p>
                        <p>
                                В случае ускорения или замедления медиана, конечно, изменится. Но она не может<br>
                                рассказать, сколько пользователей ускорилось, а сколько замедлилось.<br>
                        </p>
                        <p>
                                <strong>APDEX</strong> – метрика, которая сразу говорит: хорошо или плохо. Метрика<br>
                                работает очень просто. Мы выбираем временной интервал [0; t], такой, что если<br>
                                время показа страницы попало в него, то пользователь счастлив. Берем еще один<br>
                                интервал, (t; 4t] (в четыре раза больше первого), и считаем, что если страница<br>
                                показана за это время, то пользователь в целом удовлетворен скоростью работы,<br>
                                но уже не настолько счастлив. И применяем формулу:<br>
                        </p>
                        <p>
                                (кол-во счастливых пользователей + кол-во удовлетворенных / 2) / (кол-во всех).<br>
                        </p>
                        <p>
                                Получается значение от нуля до единицы, которое, видимо, лучше всего показывает,<br>
                                хорошо или плохо работает почта.
                        </p>
                </section>
                <section>
                        <header>
                                <h3>Как мы измеряем</h3>
                        </header>
                        <p>
                                Сейчас модуль обновления сам логирует все свои стадии, и можно легко понять<br>
                                причину замедления: медленнее стал отвечать сервер либо слишком долго<br>
                                выполняется JavaScript. Выглядит это примерно так:<br>
                        </p>
                        <code>
                                this.timings['look-ma-im-start'] = Date.now(); <br>
                                this.timings['look-ma-finish'] = Date.now();<br>
                        </code>
                        <p>
                                C помощью <code>Date.now()</code> мы получаем текущее время. Все тайминги собираются и при<br>
                                отправке рассчитываются. На этапах разница между “end” и “start” не считается,<br>
                                а все вычисления производятся в конце:<br>
                        </p>
                        <code>  var totalTime = this.timings['look-ma-finish'] - this.timings['look-ma-im-start'];</code>
                        <p>     И на сервер прилетают подобные записи:</p>
                        <code>  serverResponse=50&domUpdate=60 </code>
                </section>

        </article>
</main>
</body>
</html>